import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import i,{forwardRef as t,useRef as r,useState as n,useCallback as s,useMemo as a}from"react";import l from"classnames";import{camelCase as d}from"lodash-es";import{isForwardRef as m}from"react-is";import p from"../Dialog/Dialog.js";import c from"../DialogContentContainer/DialogContentContainer.js";import g from"../Tooltip/Tooltip.js";import u from"../../hooks/ssr/useIsomorphicLayoutEffect.js";import f from"../../hooks/useMergeRef.js";import{BUTTON_ICON_SIZE as h}from"../Button/ButtonConstants.js";import{withStaticProps as v}from"../../types/withStaticProps.js";import"../../utils/colors-vars-map.js";import{MenuButtonSize as T,MenuButtonComponentPosition as E}from"./MenuButtonConstants.js";import{DialogSize as C,DialogPosition as S,HideShowEvent as j}from"../Dialog/DialogConstants.js";import{NOOP as w}from"../../utils/function-utils.js";import{getStyle as y}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as O,ComponentDefaultTestId as b}from"../../tests/testIds.js";import M from"./MenuButton.module.scss.js";import P from"../../../icons/dist/react/Menu.js";var D={main:8,secondary:0},A=t((function(t,v){var T=t.id,E=t.className,C=t.openDialogComponentClassName,S=t.children,j=t.component,x=void 0===j?P:j,I=t.componentPosition,_=void 0===I?"start":I,z=t.size,B=void 0===z?"small":z,N=t.open,H=void 0!==N&&N,R=t.onClick,k=void 0===R?w:R,K=t.zIndex,L=void 0===K?null:K,U=t.ariaLabel,Y=void 0===U?"Menu":U,W=t.closeMenuOnItemClick,F=t.dialogOffset,V=void 0===F?D:F,q=t.dialogPosition,G=void 0===q?p.positions.BOTTOM_START:q,J=t.dialogClassName,Q=t.dialogPaddingSize,X=void 0===Q?c.sizes.SMALL:Q,Z=t.dialogShowTriggerIgnoreClass,$=t.dialogHideTriggerIgnoreClass,ee=t.onMenuHide,oe=void 0===ee?w:ee,ie=t.onMenuShow,te=void 0===ie?w:ie,re=t.disabled,ne=void 0!==re&&re,se=t.text,ae=t.tooltipContent,le=t.tooltipProps,de=t.tooltipTriggers,me=void 0===de?[A.hideTriggers.MOUSE_LEAVE]:de,pe=t.tooltipPosition,ce=void 0===pe?"right":pe,ge=t.startingEdge,ue=void 0===ge?"bottom":ge,fe=t.removeTabCloseTrigger,he=void 0!==fe&&fe,ve=t.tooltipReferenceClassName,Te=t.hideWhenReferenceHidden,Ee=void 0===Te||Te,Ce=t.dialogContainerSelector,Se=t.active,je=t.triggerElement,we=void 0===je?"button":je,ye=t.showTooltipOnlyOnTriggerElement,Oe=t["data-testid"],be=r(null),Me=f(v,be),Pe=n(H),De=e(Pe,2),Ae=De[0],xe=De[1],Ie=null!=Se?Se:Ae,_e=s((function(e){oe(),xe(!1);var o=be.current;o&&e&&window.requestAnimationFrame((function(){o.focus()}))}),[oe]),ze=s((function(e){var o="Escape"===(null==e?void 0:e.key);(o||W)&&e.propagate&&_e(o)}),[W,_e]),Be=s((function(e,o){_e(o===p.hideShowTriggers.ESCAPE_KEY)}),[_e]),Ne=s((function(){xe(!0),te()}),[xe,te]),He=a((function(){var e=new Set([p.hideShowTriggers.CLICK_OUTSIDE,p.hideShowTriggers.TAB_KEY,p.hideShowTriggers.ESCAPE_KEY]);return he&&e.delete(p.hideShowTriggers.TAB_KEY),[i.Children.toArray(S).map((function(o){if(!i.isValidElement(o))return null;var t={};return o.type&&o.type.supportFocusOnMount&&(t.focusOnMount=!0,e.delete(p.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(t.onClose=ze),i.cloneElement(o,t)})),Array.from(e)]}),[S,ze,he]),Re=e(He,2),ke=Re[0],Ke=Re[1],Le=a((function(){return 0===ke.length?null:i.createElement(c,{size:X,type:c.types.POPOVER},ke)}),[ke,X]),Ue=a((function(){return Object.assign(Object.assign({},D),V)}),[V]),Ye=x,We=a((function(){switch(B){case"xxs":case"xs":return 16;case"small":case"medium":case"large":return h;default:return 24}}),[B]),Fe=Ye?i.createElement(Ye,{size:""+We,role:"img","aria-hidden":"true"}):null;u((function(){xe(H)}),[H,xe]);var Ve="button"===we?{ref:Me}:{active:Ie,disabled:ne,ref:m(we)?Me:void 0},qe=i.createElement(we,Object.assign({id:T,"data-testid":Oe||O(b.MENU_BUTTON,T),type:"button",className:l(M.wrapper,E,y(M,d("size-".concat(B))),o(o(o(o({},M.active,Ie),y(M,C),Ae&&C),M.disabled,ne),M.text,se)),"aria-haspopup":"true","aria-expanded":Ae,"aria-label":!se&&Y,onMouseUp:function(e){ne?e.currentTarget.blur():k(e)},"aria-disabled":ne},Ve),"start"===_&&Fe,se&&i.createElement("span",{className:M.innerText},se),"end"===_&&Fe),Ge=function(e){return i.createElement(p,{wrapperClassName:J,position:G,containerSelector:Ce,startingEdge:ue,animationType:"expand",content:Le,moveBy:Ue,showTrigger:ne?[]:["click","enter"],hideTrigger:Ke,showTriggerIgnoreClass:Z,hideTriggerIgnoreClass:$,useDerivedStateFromProps:!0,onDialogDidShow:Ne,onDialogDidHide:Be,zIndex:L,isOpen:Ae,hideWhenReferenceHidden:Ee},e)},Je=function(e){return i.createElement(g,Object.assign({content:ae,position:ce,showTrigger:"mouseenter",hideTrigger:me,referenceWrapperClassName:ve,hideWhenReferenceHidden:Ee},le),e)};return ye?Ge(Je(qe)):Je(Ge(qe))})),x=v(A,{sizes:T,paddingSizes:C,dialogPositions:S,hideTriggers:j,componentPositions:E});export{x as default};
//# sourceMappingURL=MenuButton.js.map
